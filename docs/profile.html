<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Basic SEO -->
    <title>JNet Áî®Êà∑‰∏≠ÂøÉ | ‰∏™‰∫∫ËµÑÊñô„ÄÅÈÄöÁü•‰∏éÊî∂Ëóè</title>
    <meta name="description" content="JNet Áî®Êà∑‰∏≠ÂøÉ - ÁÆ°ÁêÜ‰∏™‰∫∫ËµÑÊñô„ÄÅÊé•Êî∂ÈÄöÁü•„ÄÅÊü•ÁúãÊî∂Ëóè„ÄÅËøΩË∏™Ê¥ªÂä®ÂéÜÂè≤">
    <meta name="keywords" content="JNet, Áî®Êà∑‰∏≠ÂøÉ, ‰∏™‰∫∫ËµÑÊñô, ÈÄöÁü•, Êî∂Ëóè, Ê¥ªÂä®">
    <meta name="author" content="NetCapture">
    <meta name="robots" content="noindex, follow">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://netcapture.github.io/JNet/profile.html">
    <meta property="og:title" content="JNet Áî®Êà∑‰∏≠ÂøÉ">
    <meta property="og:description" content="ÁÆ°ÁêÜ‰∏™‰∫∫ËµÑÊñô„ÄÅÈÄöÁü•ÂíåÊî∂Ëóè">
    <meta property="og:image" content="https://opengraph.githubassets.com/1/NetCapture/JNet">

    <!-- Canonical -->
    <link rel="canonical" href="https://netcapture.github.io/JNet/profile.html">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë§</text></svg>">

    <!-- Preload -->
    <link rel="preload" href="i18n.js" as="script">

    <style>
        :root {
            --primary: #2563eb;
            --secondary: #10b981;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --border: #e2e8f0;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f5f9;
            color: var(--dark);
        }

        .header {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--gray);
            font-weight: 600;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 16px;
            padding: 20px;
            height: fit-content;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .user-profile {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--gradient-1);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 0 auto 12px;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .user-login {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .menu {
            list-style: none;
        }

        .menu li {
            margin-bottom: 8px;
        }

        .menu a {
            display: block;
            padding: 10px 12px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            transition: all 0.2s;
        }

        .menu a:hover, .menu a.active {
            background: var(--light);
            color: var(--primary);
        }

        .menu a .count {
            float: right;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 600px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        /* Notifications */
        .notification-list {
            display: grid;
            gap: 12px;
        }

        .notification-item {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .notification-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .notification-item.unread {
            background: #eff6ff;
            border-color: #bfdbfe;
        }

        .notification-item.unread::before {
            content: '';
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 60%;
            background: var(--primary);
            border-radius: 2px;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .notification-type {
            font-weight: 600;
            font-size: 0.85rem;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--light);
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .notification-content {
            font-size: 0.9rem;
            color: var(--dark);
            line-height: 1.5;
        }

        /* Favorites */
        .favorite-list {
            display: grid;
            gap: 12px;
        }

        .favorite-item {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .favorite-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .favorite-title {
            font-weight: 600;
            margin-bottom: 6px;
        }

        .favorite-meta {
            font-size: 0.85rem;
            color: var(--gray);
            display: flex;
            gap: 12px;
        }

        /* Settings */
        .settings-form {
            max-width: 500px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        /* Login Page */
        .login-container {
            max-width: 400px;
            margin: 60px auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            text-align: center;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
        }

        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .github-login {
            background: #24292e;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .github-login:hover {
            background: #1a1e22;
            transform: translateY(-2px);
        }

        .token-login {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .token-login:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .login-hint {
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--gray);
            line-height: 1.6;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            border-left: 4px solid var(--primary);
        }

        .toast.show { display: block; }
        .toast.success { border-left-color: var(--secondary); }
        .toast.error { border-left-color: var(--danger); }

        .toast-title { font-weight: 700; margin-bottom: 4px; }
        .toast-message { font-size: 0.9rem; color: var(--gray); }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: 2;
            }
            .main-content {
                order: 1;
            }
        }

        /* Language Switcher */
        .lang-switcher {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 999;
            display: flex;
            gap: 4px;
        }

        .lang-switcher button {
            padding: 8px 14px;
            border: none;
            background: transparent;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            color: var(--dark);
        }

        .lang-switcher button:hover {
            background: rgba(37, 99, 235, 0.1);
        }

        .lang-switcher button.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .lang-switcher {
                top: 10px;
                left: 10px;
                padding: 2px;
            }

            .lang-switcher button {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div class="lang-switcher" id="langSwitcher">
        <button class="lang-btn" data-lang="zh">üá®üá≥ ‰∏≠Êñá</button>
        <button class="lang-btn active" data-lang="en">üá∫üá∏ EN</button>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">JNet</a>
            <nav class="nav-links">
                <a href="index.html" data-i18n="nav_home">È¶ñÈ°µ</a>
                <a href="discuss.html" data-i18n="nav_discuss">ËÆ®ËÆ∫Âå∫</a>
                <a href="showcase.html" data-i18n="nav_showcase">‰∫ßÂìÅÂ±ïÁ§∫</a>
                <a href="profile.html" class="active" data-i18n="nav_profile">‰∏™‰∫∫‰∏≠ÂøÉ</a>
            </nav>
        </div>
    </header>

    <!-- Login Page (if not logged in) -->
    <div id="loginPage" style="display: none;">
        <div class="login-container">
            <h2 class="login-title" data-i18n="profile_welcome">üëã Ê¨¢ËøéÂõûÊù•</h2>
            <p class="login-subtitle" data-i18n="profile_login_subtitle">ÁôªÂΩï‰ª•ËÆøÈóÆ‰∏™‰∫∫‰∏≠ÂøÉ</p>
            <div class="login-buttons">
                <button class="github-login" onclick="loginWithGitHub()">
                    <span>üîë</span>
                    <span data-i18n="profile_github_login">‰ΩøÁî® GitHub ÁôªÂΩï</span>
                </button>
            </div>
            <div class="login-hint">
                <strong data-i18n="profile_why_login">‰∏∫‰ªÄ‰πàÈúÄË¶ÅÁôªÂΩïÔºü</strong><br>
                ‚Ä¢ <span data-i18n="profile_reason1">Êî∂ËóèÂíåÁÇπËµûËÆ®ËÆ∫</span><br>
                ‚Ä¢ <span data-i18n="profile_reason2">Êé•Êî∂ÈÄöÁü•ÊèêÈÜí</span><br>
                ‚Ä¢ <span data-i18n="profile_reason3">ÂèÇ‰∏éÁ§æÂå∫‰∫íÂä®</span><br>
                ‚Ä¢ <span data-i18n="profile_reason4">Êü•Áúã‰∏™‰∫∫Ê¥ªÂä®</span>
            </div>
        </div>
    </div>

    <!-- Main Content (if logged in) -->
    <div id="mainPage" class="container" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="user-profile">
                <div class="user-avatar-large" id="userAvatar">U</div>
                <div class="user-name" id="userName">Áî®Êà∑Âêç</div>
                <div class="user-login" id="userLogin">@username</div>
            </div>
            <ul class="menu">
                <li><a href="#notifications" class="active" data-page="notifications" data-i18n="profile_notifications">üîî ÈÄöÁü• <span class="count" id="notifCount">0</span></a></li>
                <li><a href="#favorites" data-page="favorites" data-i18n="profile_favorites">‚≠ê Êî∂Ëóè <span class="count" id="favCount">0</span></a></li>
                <li><a href="#activity" data-page="activity" data-i18n="profile_activity">üìä Ê¥ªÂä®</a></li>
                <li><a href="#settings" data-page="settings" data-i18n="profile_settings">‚öôÔ∏è ËÆæÁΩÆ</a></li>
                <li><a href="#" onclick="logout()" data-i18n="profile_logout">üö™ ÈÄÄÂá∫ÁôªÂΩï</a></li>
            </ul>
        </aside>

        <!-- Content Area -->
        <main class="main-content" id="contentArea">
            <!-- Notifications Page -->
            <div id="notificationsPage" class="content-page">
                <h2 class="section-title" data-i18n="profile_notifications">üîî ÈÄöÁü•‰∏≠ÂøÉ</h2>
                <div class="notification-list" id="notificationList">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Favorites Page -->
            <div id="favoritesPage" class="content-page" style="display: none;">
                <h2 class="section-title" data-i18n="profile_favorites">‚≠ê ÊàëÁöÑÊî∂Ëóè</h2>
                <div class="favorite-list" id="favoriteList">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Activity Page -->
            <div id="activityPage" class="content-page" style="display: none;">
                <h2 class="section-title" data-i18n="profile_activity">üìä ÊàëÁöÑÊ¥ªÂä®</h2>
                <div id="activityList">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="content-page" style="display: none;">
                <h2 class="section-title" data-i18n="profile_settings">‚öôÔ∏è ËÆæÁΩÆ</h2>
                <div class="settings-form">
                    <div class="form-group">
                        <label class="form-label" data-i18n="profile_notif_settings">ÈÄöÁü•ËÆæÁΩÆ</label>
                        <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px;">
                            <input type="checkbox" id="emailNotif" checked>
                            <label for="emailNotif" data-i18n="profile_email_notif">ÈÇÆ‰ª∂ÈÄöÁü•</label>
                        </div>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <input type="checkbox" id="browserNotif" checked>
                            <label for="browserNotif" data-i18n="profile_browser_notif">ÊµèËßàÂô®ÈÄöÁü•</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="profile_privacy_settings">ÈöêÁßÅËÆæÁΩÆ</label>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <input type="checkbox" id="publicActivity" checked>
                            <label for="publicActivity" data-i18n="profile_public_activity">ÂÖ¨ÂºÄÊàëÁöÑÊ¥ªÂä®</label>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()" data-i18n="profile_save_settings">‰øùÂ≠òËÆæÁΩÆ</button>
                    <button class="btn btn-danger" style="margin-left: 10px;" onclick="clearAllData()" data-i18n="profile_clear_data">Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆ</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-title" id="toastTitle"></div>
        <div class="toast-message" id="toastMessage"></div>
    </div>

    <script src="i18n.js"></script>
    <script>
        // ÁøªËØëÈÖçÁΩÆ
        const profileTranslations = {
            zh: {
                login_title: "Ê¨¢ËøéÂõûÊù•",
                login_subtitle: "ÁôªÂΩï‰ª•ËÆøÈóÆ‰∏™‰∫∫‰∏≠ÂøÉ",
                login_why: "‰∏∫‰ªÄ‰πàÈúÄË¶ÅÁôªÂΩïÔºü",
                login_reason1: "Êî∂ËóèÂíåÁÇπËµûËÆ®ËÆ∫",
                login_reason2: "Êé•Êî∂ÈÄöÁü•ÊèêÈÜí",
                login_reason3: "ÂèÇ‰∏éÁ§æÂå∫‰∫íÂä®",
                login_reason4: "Êü•Áúã‰∏™‰∫∫Ê¥ªÂä®",
                notifications: "ÈÄöÁü•‰∏≠ÂøÉ",
                favorites: "ÊàëÁöÑÊî∂Ëóè",
                activity: "ÊàëÁöÑÊ¥ªÂä®",
                settings: "ËÆæÁΩÆ",
                logout: "ÈÄÄÂá∫ÁôªÂΩï",
                no_notifications: "ÊöÇÊó†ÈÄöÁü•",
                no_favorites: "ÊöÇÊó†Êî∂Ëóè",
                no_activity: "ÊöÇÊó†Ê¥ªÂä®",
                saved: "ËÆæÁΩÆÂ∑≤‰øùÂ≠ò",
                cleared: "Êï∞ÊçÆÂ∑≤Ê∏ÖÈô§"
            },
            en: {
                login_title: "Welcome Back",
                login_subtitle: "Login to access personal center",
                login_why: "Why login?",
                login_reason1: "Favorite and like discussions",
                login_reason2: "Receive notifications",
                login_reason3: "Participate in community",
                login_reason4: "View activity history",
                notifications: "Notifications",
                favorites: "Favorites",
                activity: "Activity",
                settings: "Settings",
                logout: "Logout",
                no_notifications: "No notifications",
                no_favorites: "No favorites",
                no_activity: "No activity",
                saved: "Settings saved",
                cleared: "Data cleared"
            }
        };

        // Merge translations
        Object.keys(profileTranslations.zh).forEach(key => {
            if (!translations.zh[key]) translations.zh[key] = profileTranslations.zh[key];
            if (!translations.en[key]) translations.en[key] = profileTranslations.en[key];
        });

        // Áî®Êà∑ÁÆ°ÁêÜ
        class UserProfileManager {
            constructor() {
                this.user = null;
                this.notifications = [];
                this.favorites = [];
                this.activity = [];
                this.loadUserData();
            }

            loadUserData() {
                const userData = localStorage.getItem('jnet_user');
                if (userData) {
                    this.user = JSON.parse(userData);
                    this.notifications = JSON.parse(localStorage.getItem('jnet_notifications') || '[]');
                    this.favorites = JSON.parse(localStorage.getItem('jnet_favorites') || '[]');
                    this.activity = JSON.parse(localStorage.getItem('jnet_activity') || '[]');
                    this.showMainPage();
                } else {
                    this.showLoginPage();
                }
            }

            showLoginPage() {
                document.getElementById('loginPage').style.display = 'block';
                document.getElementById('mainPage').style.display = 'none';
            }

            showMainPage() {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'grid';

                // Update user info
                const initial = this.user.name.charAt(0).toUpperCase();
                document.getElementById('userAvatar').textContent = initial;
                document.getElementById('userName').textContent = this.user.name;
                document.getElementById('userLogin').textContent = '@' + this.user.login;

                // Update counts
                document.getElementById('notifCount').textContent = this.notifications.filter(n => !n.read).length;
                document.getElementById('favCount').textContent = this.favorites.length;

                // Load default page
                this.loadPage('notifications');
            }

            async loginWithGitHub() {
                // GitHub ÁôªÂΩï - ‰ΩøÁî® Personal Access Token ÊñπÂºè
                // Áî±‰∫é GitHub Pages ÈôêÂà∂ÔºåÊó†Ê≥ï‰ΩøÁî® OAuthÔºåÊâÄ‰ª•Áõ¥Êé•‰ΩøÁî® Token ÊñπÂºè
                this.showToast('GitHub ÁôªÂΩï', 'ÂáÜÂ§áÁôªÂΩïÊµÅÁ®ã...', 'info');

                // ÊòæÁ§∫ÂèãÂ•ΩÁöÑÁôªÂΩïËØ¥Êòé
                const instructions = `
üîê GitHub ÁôªÂΩï

Áî±‰∫é GitHub Pages ÁéØÂ¢ÉÈôêÂà∂ÔºåÊàë‰ª¨‰ΩøÁî® Personal Access Token ÊñπÂºèÁôªÂΩï„ÄÇ

ËøôÊØî OAuth Êõ¥ÁÆÄÂçïÂÆâÂÖ®Ôºö
‚Ä¢ Êó†ÈúÄÂ§çÊùÇÈÖçÁΩÆ
‚Ä¢ Á´ãÂç≥ÁîüÊïà
‚Ä¢ ÈöèÊó∂ÂèØ‰ª•Êí§ÈîÄ

ÈúÄË¶ÅÁöÑÊùÉÈôêÔºö
‚úì repo (‰ªìÂ∫ìËÆøÈóÆÔºåÁî®‰∫é Issues)
‚úì discussions (ËÆ®ËÆ∫Âå∫)

ÂàõÂª∫ Token Âú∞ÂùÄÔºö
https://github.com/settings/tokens

ÊòØÂê¶Áé∞Âú®ÂàõÂª∫ Token Âπ∂ÁôªÂΩïÔºü
                `;

                if (confirm(instructions)) {
                    // ÊâìÂºÄ Token ÂàõÂª∫È°µÈù¢
                    window.open('https://github.com/settings/tokens', '_blank');
                    // ÁÑ∂ÂêéË∞ÉÁî® Token ÁôªÂΩï
                    this.loginWithToken();
                } else {
                    this.showToast('ÁôªÂΩïÂèñÊ∂à', 'ÊÇ®ÂèØ‰ª•Á®çÂêéÂÜçËØï', 'info');
                }
            }

            async loginWithToken() {
                // Token ÊñπÂºèÁôªÂΩï - Ê†áÂáÜÂÆûÁé∞
                const token = prompt('üîê Token ÁôªÂΩïÊñπÂºè\n\nËØ∑ËæìÂÖ• GitHub Personal Access Token:\n\nÊùÉÈôêË¶ÅÊ±Ç:\n‚úì repo (‰ªìÂ∫ìËÆøÈóÆ)\n‚úì discussions (ËÆ®ËÆ∫Âå∫)\n\nÂàõÂª∫Âú∞ÂùÄ: https://github.com/settings/tokens\n\nÊèêÁ§∫ÔºöÊé®Ëçê‰ΩøÁî® Classic TokenÔºåÂãæÈÄâ repo Âíå discussions ÊùÉÈôê');

                if (!token) {
                    this.showToast('ÂèñÊ∂à', 'ÁôªÂΩïÂ∑≤ÂèñÊ∂à', 'info');
                    return;
                }

                // È™åËØÅTokenÊ†ºÂºè
                if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                    this.showToast('ÈîôËØØ', 'Token Ê†ºÂºè‰∏çÊ≠£Á°Æ\nÂ∫î‰ª• ghp_ Êàñ github_pat_ ÂºÄÂ§¥', 'error');
                    return;
                }

                this.showToast('È™åËØÅ‰∏≠', 'Ê≠£Âú®È™åËØÅ Token...', 'info');

                try {
                    const response = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!response.ok) {
                        if (response.status === 401) {
                            throw new Error('Token Êó†ÊïàÊàñÂ∑≤ËøáÊúü');
                        } else if (response.status === 403) {
                            throw new Error('ÊùÉÈôê‰∏çË∂≥ÔºåËØ∑Ê£ÄÊü• Token ÊùÉÈôê');
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    }

                    const userData = await response.json();

                    this.user = {
                        login: userData.login,
                        avatar: userData.avatar_url,
                        name: userData.name || userData.login,
                        email: userData.email || 'Êú™ËÆæÁΩÆ',
                        token: token,
                        login_type: 'token',
                        login_time: new Date().toISOString()
                    };

                    localStorage.setItem('jnet_user', JSON.stringify(this.user));
                    localStorage.setItem('github_token', token);

                    // ÁîüÊàêÊ¨¢ËøéÈÄöÁü•
                    this.addNotification('welcome', `Ê¨¢ËøéÂõûÊù•, ${userData.login}! üéâ`);
                    this.addActivity('auth', 'ÁôªÂΩïÊàêÂäü', `Token ÊñπÂºè - ${userData.login}`);

                    this.showMainPage();
                    this.showToast('ÁôªÂΩïÊàêÂäü', `Ê¨¢ËøéÂõûÊù•, ${this.user.name}!`, 'success');

                    console.log('‚úÖ Login successful:', this.user);

                } catch (error) {
                    console.error('‚ùå Login error:', error);
                    this.showToast('ÁôªÂΩïÂ§±Ë¥•', error.message, 'error');
                    this.addActivity('auth', 'ÁôªÂΩïÂ§±Ë¥•', error.message);
                }
            }

            logout() {
                if (!confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) return;

                this.user = null;
                localStorage.removeItem('jnet_user');
                localStorage.removeItem('github_token');
                this.showLoginPage();
                this.showToast('ÊàêÂäü', 'Â∑≤ÈÄÄÂá∫ÁôªÂΩï', 'success');
            }

            addNotification(type, content) {
                const notification = {
                    id: Date.now(),
                    type: type,
                    content: content,
                    time: new Date().toISOString(),
                    read: false
                };

                this.notifications.unshift(notification);
                localStorage.setItem('jnet_notifications', JSON.stringify(this.notifications));

                // Update count
                const count = this.notifications.filter(n => !n.read).length;
                const countEl = document.getElementById('notifCount');
                if (countEl) countEl.textContent = count;

                // Browser notification
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('JNet ÈÄöÁü•', {
                        body: content,
                        icon: '/favicon.ico'
                    });
                }
            }

            addFavorite(type, id, data) {
                const key = `${type}_${id}`;
                const existing = this.favorites.find(f => f.key === key);

                if (existing) {
                    // Remove
                    this.favorites = this.favorites.filter(f => f.key !== key);
                    this.showToast('Â∑≤ÂèñÊ∂à', 'Â∑≤‰ªéÊî∂ËóèÁßªÈô§', 'success');
                } else {
                    // Add
                    this.favorites.push({
                        key,
                        type,
                        id,
                        data,
                        time: new Date().toISOString()
                    });
                    this.showToast('Â∑≤Êî∂Ëóè', 'Ê∑ªÂä†Âà∞Êî∂ËóèÂ§π', 'success');
                }

                localStorage.setItem('jnet_favorites', JSON.stringify(this.favorites));
                document.getElementById('favCount').textContent = this.favorites.length;
            }

            addActivity(type, action, details) {
                const activity = {
                    id: Date.now(),
                    type: type,
                    action: action,
                    details: details,
                    time: new Date().toISOString()
                };

                this.activity.unshift(activity);
                if (this.activity.length > 50) {
                    this.activity = this.activity.slice(0, 50);
                }
                localStorage.setItem('jnet_activity', JSON.stringify(this.activity));
            }

            markNotificationRead(id) {
                const notif = this.notifications.find(n => n.id === id);
                if (notif) {
                    notif.read = true;
                    localStorage.setItem('jnet_notifications', JSON.stringify(this.notifications));
                    this.updateNotificationUI();
                }
            }

            updateNotificationUI() {
                const count = this.notifications.filter(n => !n.read).length;
                const countEl = document.getElementById('notifCount');
                if (countEl) countEl.textContent = count;
            }

            loadPage(page) {
                // Update menu
                document.querySelectorAll('.menu a').forEach(a => {
                    a.classList.remove('active');
                    if (a.dataset.page === page) a.classList.add('active');
                });

                // Hide all pages
                document.querySelectorAll('.content-page').forEach(p => p.style.display = 'none');

                // Show selected page
                const pageEl = document.getElementById(page + 'Page');
                if (pageEl) {
                    pageEl.style.display = 'block';
                    this.renderPageContent(page);
                }
            }

            renderPageContent(page) {
                switch(page) {
                    case 'notifications':
                        this.renderNotifications();
                        break;
                    case 'favorites':
                        this.renderFavorites();
                        break;
                    case 'activity':
                        this.renderActivity();
                        break;
                    case 'settings':
                        // Settings form is static
                        break;
                }
            }

            renderNotifications() {
                const container = document.getElementById('notificationList');

                if (this.notifications.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üîî</div>
                            <div>${langManager.translate('no_notifications')}</div>
                        </div>
                    `;
                    return;
                }

                const html = this.notifications.map(n => {
                    const time = new Date(n.time).toLocaleString();
                    const typeIcon = this.getNotificationIcon(n.type);

                    return `
                        <div class="notification-item ${n.read ? '' : 'unread'}" onclick="profileManager.markNotificationRead(${n.id})">
                            <div class="notification-header">
                                <span class="notification-type">${typeIcon} ${this.getNotificationTypeLabel(n.type)}</span>
                                <span class="notification-time">${time}</span>
                            </div>
                            <div class="notification-content">${n.content}</div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            renderFavorites() {
                const container = document.getElementById('favoriteList');

                if (this.favorites.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">‚≠ê</div>
                            <div>${langManager.translate('no_favorites')}</div>
                        </div>
                    `;
                    return;
                }

                const html = this.favorites.map(f => {
                    const time = new Date(f.time).toLocaleString();
                    const title = f.data?.title || 'Â∑≤Êî∂ËóèÁöÑÂÜÖÂÆπ';

                    return `
                        <div class="favorite-item" onclick="alert('Ë∑≥ËΩ¨Âà∞: ${f.type} #${f.id}')">
                            <div class="favorite-title">${title}</div>
                            <div class="favorite-meta">
                                <span>Á±ªÂûã: ${f.type}</span>
                                <span>Êó∂Èó¥: ${time}</span>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            renderActivity() {
                const container = document.getElementById('activityList');

                if (this.activity.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìä</div>
                            <div>${langManager.translate('no_activity')}</div>
                        </div>
                    `;
                    return;
                }

                const html = this.activity.map(a => {
                    const time = new Date(a.time).toLocaleString();

                    return `
                        <div class="favorite-item">
                            <div class="favorite-title">${a.action}</div>
                            <div class="favorite-meta">
                                <span>${a.details}</span>
                                <span>${time}</span>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            getNotificationIcon(type) {
                const icons = {
                    welcome: 'üéâ',
                    system: 'üì¢',
                    discussion: 'üí¨',
                    comment: 'üìù',
                    like: 'üëç'
                };
                return icons[type] || 'üîî';
            }

            getNotificationTypeLabel(type) {
                const labels = {
                    zh: { welcome: 'Ê¨¢Ëøé', system: 'Á≥ªÁªü', discussion: 'ËÆ®ËÆ∫', comment: 'ËØÑËÆ∫', like: 'ÁÇπËµû' },
                    en: { welcome: 'Welcome', system: 'System', discussion: 'Discussion', comment: 'Comment', like: 'Like' }
                };
                const lang = langManager.getCurrentLanguage();
                return labels[lang][type] || type;
            }

            showToast(title, message, type = 'success') {
                const toast = document.getElementById('toast');
                const titleEl = document.getElementById('toastTitle');
                const messageEl = document.getElementById('toastMessage');

                titleEl.textContent = title;
                messageEl.textContent = message;
                toast.className = `toast show ${type}`;

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            saveSettings() {
                const emailNotif = document.getElementById('emailNotif').checked;
                const browserNotif = document.getElementById('browserNotif').checked;
                const publicActivity = document.getElementById('publicActivity').checked;

                const settings = { emailNotif, browserNotif, publicActivity };
                localStorage.setItem('jnet_settings', JSON.stringify(settings));

                if (browserNotif && 'Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                this.showToast('ÊàêÂäü', langManager.translate('saved'), 'success');
                this.addActivity('settings', 'Êõ¥Êñ∞ËÆæÁΩÆ', 'Áî®Êà∑ÂÅèÂ•ΩÂ∑≤Êõ¥Êñ∞');
            }

            clearAllData() {
                if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) return;

                localStorage.removeItem('jnet_user');
                localStorage.removeItem('github_token');
                localStorage.removeItem('jnet_notifications');
                localStorage.removeItem('jnet_favorites');
                localStorage.removeItem('jnet_activity');
                localStorage.removeItem('jnet_settings');

                this.showToast('ÊàêÂäü', langManager.translate('cleared'), 'success');
                setTimeout(() => location.reload(), 1000);
            }
        }

// Global instance
let profileManager;

// Toast notification (standalone function)
function showToast(title, message, type = 'success') {
    const toast = document.getElementById('toast');
    if (!toast) {
        console.warn('Toast element not found:', title, message);
        return;
    }
    const titleEl = document.getElementById('toastTitle');
    const messageEl = document.getElementById('toastMessage');

    titleEl.textContent = title;
    messageEl.textContent = message;
    toast.className = `toast show ${type}`;

    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Language switcher - Simple buttons
function initLanguageSwitcher() {
    const langButtons = document.querySelectorAll('.lang-btn');

    const updateActiveButton = () => {
        const currentLang = langManager.getCurrentLanguage();
        langButtons.forEach(btn => {
            if (btn.dataset.lang === currentLang) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    };

    langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.dataset.lang;
            langManager.setLanguage(lang);
            localStorage.setItem('jnet_language', lang);
            updateActiveButton();
            updateTranslations();
            showToast('Language', 'Switched to ' + langManager.getLanguageInfo(lang).native, 'success');
        });
    });

    updateActiveButton();
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOMContentLoaded fired');
    console.log('langManager:', typeof langManager);
    console.log('i18n.js loaded:', typeof langManager !== 'undefined');

    if (typeof langManager === 'undefined') {
        console.log('Waiting for i18n.js to load...');
        setTimeout(() => {
            console.log('After 100ms, langManager:', typeof langManager);
            if (typeof langManager === 'undefined') {
                console.error('‚ùå langManager still undefined after 100ms');
                // Show page anyway with default language
                init();
            } else {
                init();
            }
        }, 100);
        return;
    }
    init();
});

function init() {
    console.log('init() called');

    try {
        // Check if langManager exists
        if (typeof langManager === 'undefined') {
            console.error('‚ùå langManager is undefined, using fallback');
            // Show login page by default
            const loginPage = document.getElementById('loginPage');
            if (loginPage) {
                loginPage.style.display = 'block';
                console.log('Shown loginPage');
            } else {
                console.error('loginPage element not found!');
            }
            return;
        }

        console.log('‚úÖ langManager exists, proceeding with full initialization');

        // Initialize language switcher
        initLanguageSwitcher();

        // Load language from localStorage if available
        const storedLang = localStorage.getItem('jnet_language');
        if (storedLang && (storedLang === 'zh' || storedLang === 'en')) {
            langManager.setLanguage(storedLang);
        }

        // Create profile manager - this will show login or main page
        profileManager = new UserProfileManager();

        // Initialize search
        initSearch();

        // Menu navigation
        document.querySelectorAll('.menu a[data-page]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.dataset.page;
                profileManager.loadPage(page);
            });
        });

        // Initial translations
        updateTranslations();
        console.log('‚úÖ init() completed successfully');
    } catch (error) {
        console.error('‚ùå init() failed with error:', error);
        // Emergency fallback - show login page
        const loginPage = document.getElementById('loginPage');
        if (loginPage) {
            loginPage.style.display = 'block';
        }
    }
}

// Search initialization
let searchUI = null;
function initSearch() {
    // Dynamically load search module
    if (typeof SearchManager === 'undefined' || typeof SearchUIManager === 'undefined') {
        const script = document.createElement('script');
        script.src = 'search.js';
        script.onload = () => {
            setupSearch();
        };
        document.head.appendChild(script);
    } else {
        setupSearch();
    }
}

function setupSearch() {
    searchUI = new SearchUIManager(new SearchManager(langManager), langManager);
    searchUI.init();
    // Note: searchUI.init() already binds events to #searchBtn via bindEvents()
}

function updateTranslations() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const text = langManager.translate(key);
        if (text && text !== key) {
            el.textContent = text;
        }
    });
}

// Global functions for HTML
function loginWithGitHub() {
    profileManager.loginWithGitHub();
}

function loginWithToken() {
    profileManager.loginWithToken();
}

function logout() {
    profileManager.logout();
}

function saveSettings() {
    profileManager.saveSettings();
}

function clearAllData() {
    profileManager.clearAllData();
}

// Request notification permission on load
window.addEventListener('load', () => {
    if ('Notification' in window && Notification.permission === 'default') {
        // Don't request immediately, wait for user action
    }
});

// Scroll to top/down buttons
function initScrollButtons() {
    // Add scroll button styles if not already present
    if (!document.getElementById('scrollButtonStyles')) {
        const scrollStyles = document.createElement('style');
        scrollStyles.id = 'scrollButtonStyles';
        scrollStyles.textContent = `
            .scroll-buttons {
                position: fixed;
                bottom: 30px;
                right: 30px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                z-index: 999;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
            }
            .scroll-btn {
                width: 44px;
                height: 44px;
                border-radius: 50%;
                background: var(--primary);
                color: white;
                border: none;
                font-size: 18px;
                font-weight: bold;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transition: all 0.2s ease;
            }
            .scroll-btn:hover {
                background: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            }
            .scroll-btn:active {
                transform: translateY(0);
            }
        `;
        document.head.appendChild(scrollStyles);
    }

    // Create container if not already present
    if (document.getElementById('scrollButtonsContainer')) {
        return; // Already initialized
    }

    const container = document.createElement('div');
    container.id = 'scrollButtonsContainer';
    container.className = 'scroll-buttons';
    container.innerHTML = `
        <button class="scroll-btn scroll-up" title="Âêë‰∏äÊªöÂä®">‚Üë</button>
        <button class="scroll-btn scroll-down" title="Âêë‰∏ãÊªöÂä®">‚Üì</button>
    `;
    document.body.appendChild(container);

    const scrollUp = container.querySelector('.scroll-up');
    const scrollDown = container.querySelector('.scroll-down');

    scrollUp.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    scrollDown.addEventListener('click', () => {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    });

    // Show/hide buttons based on scroll position
    const toggleButtons = () => {
        const scrolled = window.scrollY;
        const maxScroll = document.body.scrollHeight - window.innerHeight;

        if (scrolled > 300) {
            container.style.opacity = '1';
            container.style.pointerEvents = 'auto';
        } else {
            container.style.opacity = '0';
            container.style.pointerEvents = 'none';
        }

        // Hide scroll-down button when at bottom
        if (scrolled >= maxScroll - 50) {
            scrollDown.style.display = 'none';
        } else {
            scrollDown.style.display = 'flex';
        }
    };

    window.addEventListener('scroll', toggleButtons);
    toggleButtons();
}

// Initialize scroll buttons after DOM is ready
window.addEventListener('load', initScrollButtons);
    </script>
</body>
</html>
